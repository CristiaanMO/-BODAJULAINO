<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Cuenta atr√°s de la boda üíç ‚Äì Mini juego</title>
  <meta name="description" content="Mini runner tipo dinosaurio para la cuenta atr√°s de la boda" />
  <!-- Phaser 3 desde CDN -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    html, body { height: 100%; margin: 0; background: #f7f7fb; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Noto Sans, "Apple Color Emoji", "Segoe UI Emoji"; }
    #game { display: grid; place-items: center; height: 100%; }
    .credits { position: fixed; bottom: 8px; left: 0; right: 0; text-align: center; font-size: 12px; color: #777; }
    .credits a { color: inherit; }
  </style>
</head>
<body>
  <div id="game"></div>
  <div class="credits">Toca para saltar ¬∑ ¬°Comparte el enlace en tu historia de Instagram!</div>

<script>
const WEDDING = {
  names: "",
  hashtag: "",
};

const width = 520;
const height = 300;

const config = {
  type: Phaser.AUTO,
  parent: 'game',
  width,
  height,
  backgroundColor: '#fff',
  physics: {
    default: 'arcade',
    arcade: { gravity: { y: 1000 }, debug: false }
  },
  scale: { mode: Phaser.Scale.FIT, autoCenter: Phaser.Scale.CENTER_BOTH },
  scene: { preload, create, update }
};

let game = new Phaser.Game(config);

let player, ground, rocks, rings, ui, started = false, gameOver = false, spawner;
let rockCounter = 0;

function preload() {
  const g = this.make.graphics({ x:0, y:0, add:false });

  // ‚ù§Ô∏è Coraz√≥n
  g.clear();
  g.fillStyle(0xE91E63, 1);
  g.fillCircle(10, 12, 8);
  g.fillCircle(22, 12, 8);
  g.fillTriangle(6, 16, 26, 16, 16, 28);
  g.generateTexture('heart', 32, 32);

  // ü™® Roca
  g.clear();
  g.fillStyle(0x555555, 1);
  g.fillCircle(16, 16, 14);
  g.generateTexture('rock', 32, 32);

  // üíç Anillo
  g.clear();
  g.lineStyle(6, 0xFFD54F, 1);
  g.strokeCircle(14, 20, 12);
  g.fillStyle(0xFFF9C4, 1);
  g.fillCircle(14, 8, 4);
  g.generateTexture('ring', 28, 32);

  // ‚ñ¨ Suelo
  g.clear();
  g.fillStyle(0x222222, 1);
  g.fillRect(0, 0, width, 4);
  g.generateTexture('ground', width, 4);
}

function create() {
  this.add.image(width/2, height-24, 'ground').setAlpha(0.15);
  ground = this.add.rectangle(width/2, height-24, width*2, 40, 0x000000, 0);
  this.physics.add.existing(ground, true);

  player = this.physics.add.sprite(90, height-80, 'heart');
  player.setBounce(0);
  player.setCollideWorldBounds(true);
  player.body.setSize(20, 24).setOffset(6, 6);

  this.physics.add.collider(player, ground);

  // Grupos de obst√°culos
  rocks = this.physics.add.group({ allowGravity: false, immovable: true });
  rings = this.physics.add.group({ allowGravity: false, immovable: true });

  // Colisiones
  this.physics.add.overlap(player, rocks, onHitRock, null, this);
  this.physics.add.overlap(player, rings, onHitRing, null, this);

  ui = {}
  ui.title = this.add.text(width/2, 60, `#BODAJULAINO üíç`, { fontSize: '28px', color: '#111', fontStyle: 'bold' }).setOrigin(0.5);
  ui.names = this.add.text(width/2, 85, `Faltan 4 d√≠as`, { fontSize: '24px', color: '#444' }).setOrigin(0.5);
  ui.instructions = this.add.text(width/2, 120, 'Toca para saltar y atrapa al anillo', { fontSize: '14px', color: '#666' }).setOrigin(0.5);

  this.input.keyboard.on('keydown-SPACE', () => handleInput.call(this));
  this.input.on('pointerdown', () => handleInput.call(this));
}

function startGame(scene) {
  started = true; gameOver = false;
  rocks.clear(true, true);
  rings.clear(true, true);
  if (spawner) spawner.remove(false);

  spawner = scene.time.addEvent({ delay: 1400, loop: true, callback: () => spawnObstacle(scene) });
  ui.instructions.setText('');
}

function handleInput() {
  if (!started) { startGame(this); jump(); return; }
  if (gameOver) { this.scene.restart(); started = false; return; }
  jump();
}

function jump() {
  if (player.body.touching.down) {
    player.setVelocityY(-480);
  }
}

// Spawnear roca y ocasionalmente un anillo
function spawnObstacle(scene) {
  const y = height - 46;

  // Siempre aparece una roca
  const rock = rocks.create(width + 20, y, 'rock');
  rock.setOrigin(0.5, 0.5);
  rock.body.setCircle(14, 2, 2);
  rock.setVelocityX(-260);

  rockCounter++;
  // Cada 3 rocas aparece un anillo
  if (rockCounter % 3 === 0) {
    const ring = rings.create(width + 80, y, 'ring');
    ring.setOrigin(0.5, 0.5);
    ring.body.setCircle(12, 2, 4);
    ring.setVelocityX(-260);
  }
}

// Si toca la roca ‚Üí rebota pero no muere
function onHitRock(player, rock) {
  player.setVelocityY(-400); // rebote hacia arriba
}

// Si toca el anillo ‚Üí fin del juego
function onHitRing() {
  if (gameOver) return;
  gameOver = true;
  if (spawner) spawner.remove(false);

  rocks.children.iterate(ch => { if (ch && ch.body) ch.setVelocityX(0); });
  rings.children.iterate(ch => { if (ch && ch.body) ch.setVelocityX(0); });

  this.add.text(width/2, height/2 - 8, '‚ù§Ô∏èJulio & Ainoa‚ù§Ô∏è', { fontSize: '20px', color: '#111', fontStyle: 'bold', align:'center' }).setOrigin(0.5);
  this.add.text(width/2, height/2 + 16, '¬°Nos vemos el s√°bado!', { fontSize: '14px', color: '#555' }).setOrigin(0.5);
  if (WEDDING.hashtag) this.add.text(width/2, height/2 + 36, WEDDING.hashtag, { fontSize: '12px', color: '#777' }).setOrigin(0.5);
}

function update(_, dt) {
  if (!started || gameOver) return;
  const s = 1 + Math.sin(performance.now()/200) * 0.02;
  player.setScale(s);
}
</script>